{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-chat"></i> Task: {{ task.title }}</h5>
            </div>
            <div class="card-body">
                <div id="chat-messages" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
                    {% for message in messages %}
                    <div class="mb-3">
                        <strong>{{ message.user.username }}</strong>
                        <small class="text-muted">({{ message.created_at.strftime('%d-%m-%Y %H:%M') }})</small>
                        <p class="mb-0">{{ message.message }}</p>
                    </div>
                    <hr>
                    {% endfor %}
                </div>
                
                <form method="POST">
                    <div class="input-group">
                        <input type="text" name="message" class="form-control" placeholder="Type your message..." required>
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-send"></i> Send
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Task Details</h5>
            </div>
            <div class="card-body">
                <p><strong>Assigned To:</strong> {{ task.assignee.username }}</p>
                <p><strong>Description:</strong><br>{{ task.description or 'N/A' }}</p>
                <p><strong>Priority:</strong> 
                    {% if task.priority == 'High' %}
                        <span class="badge bg-danger">High</span>
                    {% elif task.priority == 'Medium' %}
                        <span class="badge bg-warning">Medium</span>
                    {% else %}
                        <span class="badge bg-info">Low</span>
                    {% endif %}
                </p>
                <p><strong>Due Date:</strong> {{ task.due_date.strftime('%d-%m-%Y') if task.due_date else 'No deadline' }}</p>
                <p><strong>Status:</strong> 
                    {% if task.is_completed %}
                        <span class="badge bg-success">Completed</span>
                    {% else %}
                        <span class="badge bg-warning">Pending</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const chatMessages = document.getElementById('chat-messages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
</script>
{% endblock %}
